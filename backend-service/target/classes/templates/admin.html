<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudSecure AI - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-danger">
        <div class="container">
            <a class="navbar-brand" href="/">CloudSecure AI - Admin</a>
            <div class="navbar-nav ms-auto">
                <a class="nav-link" href="/dashboard">Dashboard</a>
                <span class="navbar-text me-3" id="userInfo">
                    Admin: <span id="username"></span>
                </span>
                <button class="btn btn-outline-light btn-sm" onclick="logout()">Logout</button>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-12">
                <h2>‚öôÔ∏è Admin Panel</h2>
                <p class="lead">Administrative functions and system management.</p>
                <div class="alert alert-warning" role="alert">
                    <strong>Warning:</strong> This is a protected admin area. Only administrators can access this page.
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üë• User Management</h5>
                        <p class="card-text">Manage system users and their permissions.</p>
                        <button class="btn btn-primary" onclick="loadUsers()">Load Users</button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üìä System Stats</h5>
                        <p class="card-text">View system statistics and performance metrics.</p>
                        <button class="btn btn-info" onclick="loadSystemStats()">View Stats</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üîí Security Settings</h5>
                        <p class="card-text">Configure security policies and settings.</p>
                        <button class="btn btn-warning" onclick="loadSecuritySettings()">Security</button>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">üîß Admin API Test</h5>
                        <p class="card-text">Test admin-only API endpoints.</p>
                        <button class="btn btn-danger" onclick="testAdminAPI()">Test Admin API</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Admin Console Output</h5>
                    </div>
                    <div class="card-body">
                        <pre id="adminConsole" class="bg-dark text-light p-3 rounded">Welcome to the Admin Console. Click on buttons above to perform administrative tasks...</pre>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Check if user is authenticated and is admin
        const token = localStorage.getItem('token');
        const user = JSON.parse(localStorage.getItem('user') || '{}');
        
        if (!token || user.role !== 'ADMIN') {
            window.location.href = '/dashboard';
        } else {
            document.getElementById('username').textContent = user.username || 'Admin';
        }
        
        // Helper function to make authenticated API calls
        async function makeAuthenticatedRequest(url) {
            try {
                const response = await fetch(url, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.status === 401) {
                    localStorage.removeItem('token');
                    localStorage.removeItem('user');
                    window.location.href = '/login';
                    return;
                }
                
                const data = await response.json();
                return { response, data };
            } catch (error) {
                return { error: error.message };
            }
        }
        
        function loadUsers() {
            document.getElementById('adminConsole').textContent = 
                'Loading users...\n\n' +
                'Mock User Data:\n' +
                '- admin@example.com (ADMIN)\n' +
                '- user1@example.com (USER)\n' +
                '- user2@example.com (USER)\n\n' +
                'Total Users: 3\n' +
                'Active Users: 3\n' +
                'Admin Users: 1';
        }
        
        function loadSystemStats() {
            document.getElementById('adminConsole').textContent = 
                'System Statistics:\n\n' +
                'Server Uptime: 2 hours 15 minutes\n' +
                'Memory Usage: 45%\n' +
                'CPU Usage: 12%\n' +
                'Database Connections: 5/100\n' +
                'Active Sessions: 3\n' +
                'Total API Calls Today: 127\n' +
                'Authentication Success Rate: 98.5%';
        }
        
        function loadSecuritySettings() {
            document.getElementById('adminConsole').textContent = 
                'Security Configuration:\n\n' +
                'JWT Token Expiration: 24 hours\n' +
                'Password Policy: Minimum 6 characters\n' +
                'Failed Login Attempts Limit: 5\n' +
                'Account Lockout Duration: 30 minutes\n' +
                'Two-Factor Authentication: Disabled\n' +
                'SSL/TLS: Enabled\n' +
                'CORS Policy: Configured\n' +
                'Rate Limiting: 100 requests/minute';
        }
        
        async function testAdminAPI() {
            document.getElementById('adminConsole').textContent = 'Testing Admin API...';
            
            const result = await makeAuthenticatedRequest('/api/api/user/admin');
            
            if (result.error) {
                document.getElementById('adminConsole').textContent = `Admin API Test Failed:\nError: ${result.error}`;
            } else {
                document.getElementById('adminConsole').textContent = 
                    `Admin API Test Successful!\n\n` +
                    `Response: ${JSON.stringify(result.data, null, 2)}\n\n` +
                    `Status: ${result.response.status}\n` +
                    `Access Level: ADMIN CONFIRMED`;
            }
        }
        
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/';
        }
    </script>
</body>
</html>
